<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        .rating-summary {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .rating-average {
            font-size: 2em;
            font-weight: bold;
            color: #4a90e2;
        }
        .review-form {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .form-group textarea {
            min-height: 100px;
        }
        button {
            background: #4a90e2;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #357abd;
        }
        .review-item {
            border-bottom: 1px solid #ddd;
            padding: 15px 0;
        }
        .review-header {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 10px;
        }
        .review-author {
            font-weight: bold;
        }
        .review-rating {
            color: #f39c12;
        }
        .review-date {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        .review-content {
            line-height: 1.6;
        }
        .login-prompt {
            background: #f0f0f0;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .star-rating {
            color: #f39c12;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <header>
        <%- include('../partials/header') %>
        <%- include('../partials/nav') %>
    </header>

    <main>
        <div class="vehicle-info">
            <h1><%= vehicle.inv_make %> <%= vehicle.inv_model %> Reviews</h1>
        </div>

        <!-- Rating Summary -->
        <div class="rating-summary">
            <div class="rating-average">
                <%= ratingStats.average_rating %> / 5
            </div>
            <div class="rating-total">
                Based on <%= ratingStats.total_reviews %> 
                <%= ratingStats.total_reviews === 1 ? 'review' : 'reviews' %>
            </div>
        </div>

        <!-- Review Form -->
        <% if (loggedin) { %>
            <% if (!userHasReviewed) { %>
                <div class="review-form">
                    <h2>Write a Review</h2>
                    <form action="/reviews/add" method="POST">
                        <input type="hidden" name="inv_id" value="<%= vehicle.inv_id %>">
                        
                        <div class="form-group">
                            <label for="review_rating">Rating:</label>
                            <select name="review_rating" id="review_rating" required>
                                <option value="">Select a rating</option>
                                <option value="5">5 - Excellent</option>
                                <option value="4">4 - Very Good</option>
                                <option value="3">3 - Good</option>
                                <option value="2">2 - Fair</option>
                                <option value="1">1 - Poor</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="review_text">Your Review:</label>
                            <textarea 
                                name="review_text" 
                                id="review_text" 
                                placeholder="Share your experience with this vehicle..."
                                required
                            ></textarea>
                        </div>
                        
                        <button type="submit">Submit Review</button>
                    </form>
                </div>
            <% } else { %>
                <div class="review-form">
                    <p>You have already reviewed this vehicle.</p>
                </div>
            <% } %>
        <% } else { %>
            <div class="login-prompt">
                <p><a href="/account/login">Log in</a> to write a review.</p>
            </div>
        <% } %>

        <!-- Reviews List -->
        <div class="reviews-list">
            <h2>Customer Reviews</h2>
            
            <% if (reviews && reviews.length > 0) { %>
                <% reviews.forEach(review => { %>
                    <div class="review-item">
                        <div class="review-header">
                            <span class="review-author">
                                <%= review.account_firstname %> <%= review.account_lastname %>
                            </span>
                            <span class="review-rating">
                                <% for(let i = 0; i < review.review_rating; i++) { %>★<% } %>
                                <% for(let i = review.review_rating; i < 5; i++) { %>☆<% } %>
                                (<%= review.review_rating %>/5)
                            </span>
                            <span class="review-date">
                                <%= new Date(review.review_date).toLocaleDateString() %>
                            </span>
                        </div>
                        <div class="review-content">
                            <%= review.review_text %>
                        </div>
                    </div>
                <% }); %>
            <% } else { %>
                <p>No reviews yet. Be the first to review this vehicle!</p>
            <% } %>
        </div>
    </main>

    <footer>
        <%- include('../partials/footer') %>
    </footer>
</body>
</html>